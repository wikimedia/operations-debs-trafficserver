From: Jean Baptiste Favre <debian@jbfavre.org>
Date: Wed Mar 14 16:40:34 2018 +0100
Subject: Make documentation build compatible with both Python 2 and 3
Last-Update: 2018-03-14
---
This patch header follows DEP-3: http://dep.debian.net/deps/dep3/
--- a/doc/ext/traffic-server.py
+++ b/doc/ext/traffic-server.py
@@ -34,6 +34,15 @@ from sphinx.roles import XRefRole
 from sphinx.locale import l_, _
 import sphinx
 
+# 2/3 compat logic
+try:
+    basestring
+
+    def is_string_type(s):
+        return isinstance(s, basestring)
+except NameError:
+    def is_string_type(s):
+        return isinstance(s, str)
 
 class TSConfVar(std.Target):
     """
@@ -63,7 +72,7 @@ class TSConfVar(std.Target):
         field = nodes.field()
         field.append(nodes.field_name(text=tag))
         body = nodes.field_body()
-        if (isinstance(value, basestring)):
+        if is_string_type(value):
             body.append(sphinx.addnodes.compact_paragraph(text=value))
         else:
             body.append(value)
@@ -190,7 +199,7 @@ class TSStat(std.Target):
         field = nodes.field()
         field.append(nodes.field_name(text=tag))
         body = nodes.field_body()
-        if (isinstance(value, basestring)):
+        if is_string_type(value):
             body.append(sphinx.addnodes.compact_paragraph(text=value))
         else:
             body.append(value)
--- a/doc/manpages.py
+++ b/doc/manpages.py
@@ -66,4 +66,4 @@ if __name__ == '__main__':
     # Print the names of the man pages for the requested manual section.
     for page in man_pages:
         if options.section == 0 or options.section == int(page[4][0]):
-            print page[1] + '.' + page[4]
+            print( page[1] + '.' + page[4] )
--- a/doc/checkvers.py
+++ b/doc/checkvers.py
@@ -29,30 +29,30 @@ if __name__ == '__main__':
     # Check whether we have a recent version of sphinx. EPEL and CentOS are completely crazy and I don't understand their
     # packaging at all. The test below works on Ubuntu and places where sphinx is installed sanely AFAICT.
     if options.checkvers:
-        print 'checking for sphinx version >= 1.2... ',
+        print ( 'checking for sphinx version >= 1.2... ' ),
         # Need at least 1.2 because of some command line options stuff HRP added.
         # Also 1.2 guarantees sphinx.version_info is available.
         try:
             import sphinx
 
             if 'version_info' in dir(sphinx):
-                print 'Found Sphinx version {0}'.format(sphinx.version_info)
+                print ( 'Found Sphinx version {0}'.format(sphinx.version_info) )
             else:
                 version = sphinx.__version__
-                print 'Found Sphinx version (old) {0}'.format(sphinx.__version__)
+                print ( 'Found Sphinx version (old) {0}'.format(sphinx.__version__) )
                 sphinx.version_info = version.split('.')
 
             if sphinx.version_info < (1, 2):
                 sys.exit(1)
 
         except Exception as e:
-            print e
+            print ( e )
             sys.exit(1)
 
-        print 'checking for sphinx.writers.manpage... ',
+        print ( 'checking for sphinx.writers.manpage... ' ),
         try:
             from sphinx.writers import manpage
-            print 'yes'
+            print ( 'yes' )
         except Exception as e:
-            print e
+            print ( e )
             sys.exit(1)
